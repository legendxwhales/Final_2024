---
title: "Covid91 vaccine study Final2024"
author: "Wayne Jarvis"
output: 
  html_document:
    number_sections: true
    toc: true
    toc_depth: 5
date: "`r Sys.Date()`" 
---

```{r include=FALSE,echo=FALSE}
require(tidyverse)
require(tigerstats)
require(forcats)
FinalDat <-read.csv(file="finalSumr2024.csv",header=TRUE)
#recode to remove the annoying "X" from the dataframe
FinalData <- FinalDat  %>% select(-one_of("X"))
FinalData <- FinalData %>%
mutate(across(where(is.character), as.factor))
FinalData$treatment <- relevel(FinalData$treatment,ref="placebo")
#FinalData$infected <- relevel(FinalData$infected,ref="OK")
M = filter(FinalData, sex =="M")
F = filter(FinalData, sex =="F")
gay = filter(FinalData, LGBTQ =="gay")
Druguser = filter(FinalData, DrugUser =="yes")
```

To ensure efficient data evaluation, it was essential to categorize the variables into four distinct groups. I created four variables labeled "M", "F", "gay", and "drug users" to separate them based on whether they should receive the Covid-19 vaccine. This allowed me to establish the effectiveness intervals. Each group was stored in its own variable for clarity and analysis.

# Introduction

A new  preventative vaccine (covid921) is under test in clinical trials. Given the nature of this vaccine it is suspected that the drug may exhibit different effectiveness across the variety of subpopulations tracked. Consider population subgroups by gender( guys and gals), drug use, and sexual orientation. Write a complete report that separately considers this drug for each subgroup and your recommendations as to whether people in the subgroup should take the vaccine. Structure your report in four sections each devoted to one of the four subgroups, use null and alternative hypothesis statements and correct statistical verbage when referencing p-values in conclusions.

## Males

### Barplot

```{r}
dd2 <- M %>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))


# the group_by followed by summarize(count=n())

basicC <- ggplot(dd2,aes(x=infected,y=count,fill=treatment))
basicC + geom_bar(stat="identity",position="dodge")

#Now for percentage plot

basicCC <- ggplot(dd2,aes(x=infected,y=prcnt*100,fill=treatment)) 
basicCC + geom_bar(stat="identity", position = "dodge")
```

This plot illustrates the relationship between Covid-19 infection rates, vaccine uptake, and placebo usage among the male population.The first graph displays the counts of individuals who either contracted Covid-19 or remained healthy, and whether they received the vaccine or a placebo. The second graph shows the percentage of people who had the placebo or the Covid-19 vaccine, and whether or not they contracted Covid-19. These groups are separated by their Covid-19 infection status and whether they received the placebo or vaccine.Among those who contracted Covid-19, the majority (around 75%) received the placebo, while a significantly smaller portion (about 25%) had the vaccine. Among the individuals who remained healthy, the distribution was more balanced, with a roughly 50/50 split between those who took the placebo and those who received the vaccine.The code used to generate this barplot starts with a code block labeled "dd2," which appears in the environment pane. This block contains four variables: treatment, infected, count, and percent. The second group, called "basicC," is also visible in the environment and contains 11 variables, which help create the first plot. The final code group, "basicCC," located in the files pane, contains 11 variables that are essential for generating the second, percentage-based plot.

### Numerical Results

```{r}
table1 <- xtabs(~infected + treatment, data=M)
prop.table(table1, 1) * 100
prop.table(table1, 2) * 100
```

These numerical results highlight the percentages of males who contracted Covid-19 after receiving either the placebo or the vaccine.Among the males who got Covid-19, a large percentage (73.80%) had received the placebo, compared to only 26.20% who contracted the virus after taking the vaccine. For the males who remained healthy, 50.01% of those who took the placebo were fine, while 49.99% of those who received the vaccine were also healthy.These findings indicate that the Covid-19 vaccine was notably effective in males, with only 26.20% of vaccinated individuals contracting the virus, while a much higher percentage (73.80%) of those who received the placebo did. This difference is significant and suggests the vaccine's effectiveness.

### Inferential Results 

```{r}
# Chi-square test
chisq.test(table1)

# Expected counts
chisq.test(table1)$expected

# Standardized residuals (optional)
chisq.test(table1)$residuals

# Fisher's Exact Test
Msfish <- fisher.test(table1)
Msfish

```

The most important result to focus on is the output from the Fisher’s Exact Test. The test produced an extremely small p-value of 0.00000000000000022, which is essentially zero. A p-value this small indicates that the observed results are highly unlikely to be due to random chance.Consequently, we can confidently reject the null hypothesis that COVID-19 infection status is independent of sex.The odds ratio is 2.815604, meaning that individuals who received the placebo were nearly three times more likely to become infected than those who received the vaccine. This represents a substantial effect and strongly suggests that the vaccine is effective.


```{r}
effect <- Msfish$p.value/(Msfish$p.value +1)
effectivenessM = Msfish$estimate/(Msfish$estimate +1)*100
print(effectivenessM)
```

```{r}
low=(Msfish$conf.int[1]/(Msfish$conf.int[1] +1))*100
hi=(Msfish$conf.int[2]/(Msfish$conf.int[2] +1))*100
options(digits=2)
```

## Effectiveness Confidence Interval `r low`  to `r hi`

The section above displays the estimated effectiveness of the COVID-19 vaccine for males. Vaccine effectiveness values above 50% indicate that the vaccine provides meaningful protection. Based on the confidence interval shown, we can conclude that the vaccine is effective in reducing COVID-19 infection among males.The odds ratio also provides insight into how effective the vaccine is. For males, the odds ratio is approximately 73.8, and the corresponding effectiveness confidence interval ranges from about 68.85% to 78.32%. This interval suggests a consistently high level of protection.

## Females

### Barplot

```{r}
dd2 <- F %>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))


# the group_by followed by summarize(count=n())

basicC <- ggplot(dd2,aes(x=infected,y=count,fill=treatment))
basicC + geom_bar(stat="identity",position="dodge")

#Now for percentage plot

basicCC <- ggplot(dd2,aes(x=infected,y=prcnt*100,fill=treatment)) 
basicCC + geom_bar(stat="identity", position = "dodge")
```

This plot illustrates the female portion of the population and the relationship between COVID-19 infection and whether each individual received the vaccine or a placebo.The first graph displays the raw counts of females who either contracted COVID-19 or remained uninfected, grouped by whether they received the vaccine or the placebo. The second graph shows the corresponding percentages, again separated by infection status and treatment type.From the plot, we can see that among females who became infected, roughly 65% had received the placebo, while about 35% had received the vaccine. For females who remained healthy, the distribution is close to 50/50, with the vaccine group slightly higher. Compared with the male plot, fewer females who had the placebo contracted COVID-19, and more females who had the vaccine contracted it; however, the overall pattern remains the same: individuals who received the placebo had a higher infection rate than those who were vaccinated.The code used to generate this bar plot begins with the creation of the object dd2, which appears in the environment pane and contains four variables: treatment, infected, count, and prcent (percent). The next object, basicC, contains 11 variables and is used to produce the first (count-based) plot. The final object, basicCC, also containing 11 variables, is used to generate the percentage-based plot shown second.

### Numerical results 

```{r}
table1 <- xtabs(~infected + treatment, data=F)
prop.table(table1, 1) * 100
prop.table(table1, 2) * 100
```

These numerical results provide the exact percentages of females who contracted COVID-19 after receiving either the placebo or the vaccine.Consistent with what was estimated from the bar plot, about 65% of the infected females had taken the placebo, while only about 35% had taken the vaccine. Among the females who remained uninfected, the distribution was evenly split: approximately 50% had received the placebo and 50% had received the vaccine. These values indicate that the COVID-19 vaccine is effective for females, as a much smaller proportion of vaccinated women became infected compared to those who received the placebo. This difference is substantial and meaningful.

### Inferential 

```{r}
# Chi-square test
chisq.test(table1)

# Expected counts
chisq.test(table1)$expected

# Standardized residuals (optional)
chisq.test(table1)$residuals

# Fisher's Exact Test
Msfish <- fisher.test(table1)
Msfish

```

The most important result to focus on is the output from the Fisher’s Exact Test. The p-value obtained was extremely small—0.000000001—which is effectively zero. Such a small p-value indicates that the observed results are highly unlikely to have occurred by chance.As a result, we can confidently reject the null hypothesis that COVID-19 infection status is independent of sex.The odds ratio is 1.9, meaning that females who received the placebo were nearly twice as likely to contract COVID-19 compared to those who received the vaccine. This represents a meaningful difference and provides strong evidence that the vaccine is effective.


```{r}
effect <- Msfish$p.value/(Msfish$p.value +1)
effectivenessM = Msfish$estimate/(Msfish$estimate +1)*100
print(effectivenessM)
```

```{r}
low=(Msfish$conf.int[1]/(Msfish$conf.int[1] +1))*100
hi=(Msfish$conf.int[2]/(Msfish$conf.int[2] +1))*100
options(digits=2)
```

## Effectiveness Confidence Interval `r low`  to `r hi`

The section above displays the estimated effectiveness of the COVID-19 vaccine for females. Vaccine effectiveness values above 50% indicate meaningful protection. Based on the confidence interval shown, we can conclude that the vaccine is effective at reducing COVID-19 infections among females. Although the effectiveness is slightly lower than what was observed in males, it remains strongly protective.The odds ratio provides another measure of vaccine effectiveness. For females, the odds ratio is approximately 65, with a confidence interval ranging from about 59.8% to 69.92%. This interval reflects a consistently high level of protection for the female population.

## LGBTQ



## Druggies


# Overall Results and Conclusions